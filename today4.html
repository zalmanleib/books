<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Rambam Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f4f4f4;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 15px;
      width: 100%;
      text-align: center;
      font-size: 1.5em;
    }
    main {
      margin: 20px;
      text-align: center;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #3498db;
      color: white;
      transition: background 0.3s;
    }
    button:hover {
      background: #2980b9;
    }
    iframe {
      width: 90%;
      height: 80vh;
      border: none;
      margin-top: 20px;
      background: white;
    }
  </style>
</head>
<body>
  <header>Daily Rambam Viewer</header>
  <main>
    <div>
      <button onclick="setCycle(1)">Perek Echad</button>
      <button onclick="setCycle(3)">Shlosha Perakim</button>
    </div>
    <div>
      <button onclick="prevDay()">Previous</button>
      <button onclick="today()">Today</button>
      <button onclick="nextDay()">Next</button>
    </div>
    <div>
      <button onclick="changeViewer()">Change Viewer</button>
    </div>
    <iframe id="pdfFrame"></iframe>
  </main>

  <script>
    const pdfFrame = document.getElementById("pdfFrame");

    const viewers = [
      (url) => url,
      (url) => `https://docs.google.com/viewer?embedded=true&url=${encodeURIComponent(url)}`,
      (url) => `https://mozilla.github.io/pdf.js/web/viewer.html?file=${encodeURIComponent(url)}`
    ];
    let currentViewerIndex = 0;

    let cycle = null;
    let startDate = new Date("2024-09-29"); 
    let currentDay = 0;

    function setCycle(type) {
      cycle = type;
      updateDayFromToday();
    }

    function updateDayFromToday() {
      const todayDate = new Date();
      const diffTime = todayDate - startDate;
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      currentDay = diffDays;
      updatePdf();
    }

    function buildUrl() {
      if (!cycle) return "";
      let base = "https://s3.amazonaws.com/DvarMalchus/rambam/1/";
      let num = (cycle === 1 ? currentDay + 1 : (currentDay + 1) * 3);
      return `${base}${num}.pdf`;
    }

    function updatePdf() {
      const url = buildUrl();
      if (!url) return;
      pdfFrame.src = viewers[currentViewerIndex](url);
    }

    function prevDay() {
      if (cycle && currentDay > 0) {
        currentDay--;
        updatePdf();
      }
    }

    function nextDay() {
      if (cycle) {
        currentDay++;
        updatePdf();
      }
    }

    function today() {
      if (cycle) {
        updateDayFromToday();
      }
    }

    function changeViewer() {
      currentViewerIndex = (currentViewerIndex + 1) % viewers.length;
      updatePdf();
    }
  </script>
</body>
</html>
