<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Morah Shiur — Rambam Daily</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f172a;color:#f5f5f5;display:flex;align-items:center;justify-content:center;padding:10px}
    .container{max-width:900px;width:100%;background:#1e293b;border-radius:10px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,0.5)}
    header h1{margin:0 0 10px;text-align:center}
    .controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;justify-content:center}
    input,button{padding:6px 10px;border-radius:6px;border:none}
    input{background:#334155;color:#f5f5f5}
    button{cursor:pointer;background:#4c1d95;color:white}
    iframe{width:100%;height:600px;border:0;border-radius:6px;background:white;display:none}
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Morah Shiur — Rambam Daily</h1>
  </header>

  <div class="controls">
    <label>Date: <input type="date" id="pickDate"></label>
    <button id="cycle1">Perek Echad</button>
    <button id="cycle3">Shlosha Perakim</button>
    <button id="prevBtn">← Prev</button>
    <button id="todayBtn">Today</button>
    <button id="nextBtn">Next →</button>
    <button id="openTabBtn">Open Fullscreen</button>
  </div>

  <!-- PDF.js viewer iframe -->
  <iframe id="pdfFrame"></iframe>
</div>

<script>
(function(){
  const startDate = "1984-04-28"; // hidden baseline Day 1
  const lengths = { "3":339, "1":1017 };
  const bases   = { "3":"https://s3.amazonaws.com/DvarMalchus/rambam/3/",
                    "1":"https://s3.amazonaws.com/DvarMalchus/rambam/1/" };

  const pickDate = document.getElementById("pickDate");
  const pdfFrame = document.getElementById("pdfFrame");
  let currentCycle = null;
  let currentUrl = "";

  function parseDate(s){ const [y,m,d]=s.split("-").map(Number); return new Date(y,m-1,d); }
  function diffDays(a,b){ return Math.floor((a-b)/(1000*60*60*24)); }
  function computeDay(len,startStr,selStr){
    const start=parseDate(startStr), sel=parseDate(selStr);
    const diff=diffDays(sel,start);
    return ((diff%len)+len)%len + 1;
  }
  function update(dateStr){
    if(!currentCycle){ pdfFrame.style.display="none"; return; }
    const len=lengths[currentCycle];
    const d=computeDay(len,startDate,dateStr);
    currentUrl=bases[currentCycle]+d+".pdf";
    // use PDF.js universal viewer
    pdfFrame.src = "https://mozilla.github.io/pdf.js/web/viewer.html?file=" + encodeURIComponent(currentUrl);
    pdfFrame.style.display="block";
  }

  // controls
  document.getElementById("todayBtn").onclick=()=>{pickDate.value=new Date().toISOString().slice(0,10);update(pickDate.value)};
  document.getElementById("prevBtn").onclick=()=>{
    let d=parseDate(pickDate.value);d.setDate(d.getDate()-1);pickDate.value=d.toISOString().slice(0,10);update(pickDate.value);
  };
  document.getElementById("nextBtn").onclick=()=>{
    let d=parseDate(pickDate.value);d.setDate(d.getDate()+1);pickDate.value=d.toISOString().slice(0,10);update(pickDate.value);
  };
  pickDate.onchange=()=>update(pickDate.value);

  document.getElementById("cycle1").onclick=()=>{currentCycle="1";update(pickDate.value)};
  document.getElementById("cycle3").onclick=()=>{currentCycle="3";update(pickDate.value)};
  document.getElementById("openTabBtn").onclick=()=>{ if(currentUrl) window.open(currentUrl,"_blank"); };

  // init
  pickDate.value=new Date().toISOString().slice(0,10);
  pdfFrame.style.display="none";
})();
</script>
</body>
</html>
